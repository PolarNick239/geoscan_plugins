# Обработка геодезических измерений

Плагин предназначен для обработки геодезических наблюдений, 
записанных при помощи беспилотных аэрофотосъемочных комплексов **Геоскан** и базовой станции.

Результат обработки - точные координаты центров фотографирования.

<img src="https://user-images.githubusercontent.com/27758021/120221326-e1662880-c246-11eb-913d-9b8693180ffc.JPG" width="80%" height="80%">

## Содержание
1. [Исходные данные](#исходные-данные)
3. [Предварительный анализ данных](#предварительный-анализ-данных)
4. [Обработка](#обработка)
5. [Результаты обработки](#результаты-обработки)

## Исходные данные

Плагин предлагает два режима обработки: "**Одна база и один полет**" и "**Одна база и несколько полетов**".

Первый режим предназначен для обработки одного полета, обеспеченного наблюдениями базовой станции.
Второй режим дает возможность обработать несколько полетов по одной базовой станции, которая обеспечивает наблюдениями выбранные полеты.

Входные данные дополнительно проверяются на соответствие временным рамкам и 
наличие пропусков эпох в файле ровера (относительно событий - моментов фотографирования).

### Одна база и один полет

Для обработки требуются:
- **RINEX-файл ровера** (наблюдения, полученные при помощи БПЛА)
- **RINEX-файл базовой станции**
- Текстовый **файл телеметрии**, который формируется бортом **Геоскан**

Перед обработкой необходимо указать **координаты базовой станции** и **систему координат**, в которой они будут заданы.
Дополнительно может быть задана **высота антенны** и **тип антенны**. 
Если данная информация содержится в RINEX-файле базовой станции, то соответствующие поля будут заполнены автоматически.

Дополнительно может быть добавлен второй **файл телеметрии**, если борт выполнял съемку двумя камерами.

### Одна база и несколько полетов

Для обработки требуются:
- **RINEX-файл базовой станции**, обеспечивающий наблюдениями необходимые полеты
- Путь к директории с аэрофотосъемочными данными, содержащими **RINEX-файлы** и файлы телеметрии, записанные бортами Геоскан

Информация о **базовой станции** заполняется по аналогии с предыдущим режимом.

#### Поиск полетов в директории

После выбора директории с аэрофотосъемочными данными, необходимо **Найти полеты в выбранной директории**. 
Действие этой кнопки найдет соответствия по времени между файлами телеметрии и RINEX-файлами бортов.
Для уточнения параметров поиска воспользуйтесь **Настройками поиска**.

Файлы в директории, которые по какой-либо причине не были учтены при поиске, 
будут перечислены в появившемся окне предупреждения с описанием причины и пути к файлу.

![gnss6](https://user-images.githubusercontent.com/27758021/121709295-142edd00-cae1-11eb-938c-3c1653ee7d3a.JPG)

Далее, необходимо проверить найденные соответствия "RINEX - телеметрия" и оставить галочки в первой колонке таблицы, 
чтобы включить пары файлов в обработку.

<img src="https://user-images.githubusercontent.com/27758021/121708738-88b54c00-cae0-11eb-8c79-3be4a6259bc1.JPG" width="80%" height="80%">

## Предварительный анализ данных

Кнопка **⌕** позволяет отобразить подробную информацию о выбранном RINEX-файле при помощи **RTKPLOT**, входящим в комплект утилит **RTKLIB**.

Проанализировав входные данные, вы можете задать **маску возвышения** и **исключить выбранные спутники**. 
Отдельно можно задать, какие спутниковые группировки будут учитываться при обработке.

<img src="https://user-images.githubusercontent.com/27758021/120227135-49ba0780-c251-11eb-86f8-c502aa171245.JPG" width="40%" height="40%">  <img src="https://user-images.githubusercontent.com/27758021/120227151-50e11580-c251-11eb-81bd-df00353bd861.JPG" width="40%" height="40%">

## Обработка

Определив входные данные и параметры обработки, можно переходить к самой обработке.
Для этого необходимо нажать на кнопку **Обработать**.

Процесс обработки включает в себя проверку исходных данных. 
В случае каких-либо проблем, могут появиться сообщения об ошибках, а также предупреждения, дающие возможность продолжить обработку.

Существует экспериментальная опция **Ограничить используемое количество эпох...**, 
которая сокращает RINEX-файл ровера и оставляет пользовательское количество эпох рядом с каждым моментом фотографирования в файле. 
Включение данной опции может как положительно, так и отрицательно повлиять на качество результата.

## Результаты обработки

Результаты обработки можно _визуализировать_, _экспортировать_ и _загрузить_ напрямую в проект Agisoft Metashape.
Если вы используете режим массовой обработки, то по окончании обработки формируется отчет в формате Excel,
в котором указывается процент фиксированных решений, количество пропущенных эпох и системные ошибки, произошедшие в процессе обработки.

_Визуализировать_ результаты обработки можно при помощи кнопок **Отобразить трек полета** и **Отобразить центры фотографирования**. 
При помощи первой кнопки визуализируются координаты всех эпох полета, при помощи второй - только центры фотографирования. 

Немного о решениях. Фиксированное решение отображается зеленым (Q=1), плавающее - желтым (Q=2). 
Изучить подробнее результаты можно через **Edit -> Solution Source...**, а также другими методами **RTKPLOT**.

<img src="https://user-images.githubusercontent.com/27758021/120230433-f303fc00-c257-11eb-9aa1-493df1466ae2.JPG" width="40%" height="40%">  
<img src="https://user-images.githubusercontent.com/27758021/120230435-f4352900-c257-11eb-8af6-4797f4cc4473.JPG" width="40%" height="40%">

_Экспортировать_ результаты обработки можно при помощи кнопки **Экспорт результатов в xml / txt**. 
После нажатия кнопки плагин предложит выбрать директорию для экспорта.
Результат экспорта - файл формата Agisoft XML и TXT-файл.

Мгновенно _загрузить_ результат в проект можно при помощи кнопки **Загрузить результат в проект**.
Единственным требованием данного процесса являются ранее загруженные снимки в проект.
Для снимков, которые получили решение, будет назначена точность 15 см. 
Для тех, которые не получили решения, будут установлены навигационные координаты из файла телеметрии и точность 10 м.
